<!DOCTYPE html>
<html>
   <link rel="stylesheet" type="text/css" href="index.css">
   <head>
      <title>piObdDashboard</title>
      <style>
         body { margin: 0; padding-bottom: 3rem; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
         #form { background: rgba(0, 0, 0, 0.15); padding: 0.25rem; position: fixed; bottom: 0; left: 0; right: 0; display: flex; height: 3rem; box-sizing: border-box; backdrop-filter: blur(10px); }
         #input { border: none; padding: 0 1rem; flex-grow: 1; border-radius: 2rem; margin: 0.25rem; }
         #input:focus { outline: none; }
         #form > button { background: #333; border: none; padding: 0 1rem; margin: 0.25rem; border-radius: 3px; outline: none; color: #fff; }
         #messages { list-style-type: none; margin: 0; padding: 0; }
         #messages > li { padding: 0.5rem 1rem; }
         #messages > li:nth-child(odd) { background: #efefef; }
      </style>
   </head>
   <body>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
      <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
      <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
      <!-- Optional theme -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
      <!-- Latest compiled and minified JavaScript -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.1.2/socket.io.js"></script>
      <div class="container">
         <span>Status:</span>
         <span id="statusField"></span>
      </div>
      </div>
      <div class="container">
         <div class="row">
            <div class="col-xs-4">
               <h1 id=speedField>--</h1>
               <h4>MPH</h4>
            </div>
            <div class="col-xs-4">
               <h1 id=rpmField>--</h1>
               <h4>RPM</h4>
            </div>
         </div>
         <div class="row">
            <div class="col-xs-4">
               <h3 id=throttleField>--</h3>
               <h6>% Throttle</h6>
            </div>
            <div class="col-xs-4">
               <h6 id=cabinTempField>--</h6>
               <h6>Cabin Temp (F)</h6>
            </div>
         </div>
      </div>
      <div class="wrapper">
         <div id="speedChart"></div>
         <script>
            var x_max = 100;
             var speedLayout = {
                 autosize: true,
                 height: 300,
                 margin: {
                   l: 55,
                   r: 10,
                   b: 25,
                   t: 10,
                   pad: 1
                 },
                 font: {
                   size: 20,
                   color: '#1F77B4'
                 }
                 <!-- paper_bgcolor: '#000000', -->
                  <!-- plot_bgcolor: '#c7c7c7' -->
             };
             
             Plotly.react('speedChart',[{
                 y:[0],
                 type:'line'
             }], speedLayout);
             
             var cntSpeed = 0;
             
             function updateSpeedChart(speed) {
                 Plotly.extendTraces('speedChart',{ y:[[speed]]}, [0]);
                 cntSpeed++;
                 if(cntSpeed > x_max) {
                     Plotly.relayout('speedChart',{
                         xaxis: {
                             range: [cntSpeed-x_max,cntSpeed]
                         }
                     });
                 }
             }
         </script>
      </div>
      <div class="wrapper">
         <div id="rpmChart"></div>
         <script>
            var rpmLayout = {
                 autosize: true,
                 height: 300,
                 margin: {
                   l: 55,
                   r: 10,
                   b: 25,
                   t: 10,
                   pad: 1
                 },
                 font: {
                   size: 20,
                   color: '#eb3434'
                 }
                 <!-- paper_bgcolor: '#000000', -->
                  <!-- plot_bgcolor: '#c7c7c7' -->
             };
             
             Plotly.react('rpmChart',[{
                 y:[0],
                 type:'line',
                                 line: {color: '#eb3434'}
            
             }], rpmLayout);
             
             var cnt = 0;
             
             function updateRpmChart(rpm) {
                 Plotly.extendTraces('rpmChart',{ y:[[rpm]]}, [0]);
                 cnt++;
                 if(cnt > x_max) {
                     Plotly.relayout('rpmChart',{
                         xaxis: {
                             range: [cnt-x_max,cnt]
                         }
                     });
                 }
             }
         </script>
      </div>
      <script>
         var socket = io();
         if (socket != null) {
           $("#statusField").text = "Connected"
         }
         
         socket.on('data', function(msg) {
           var carData = $.parseJSON(msg);
           console.log(carData);
           var speed = parseInt(carData['speed']);
           var rpm = parseInt(carData['rpm']);
           var throttle = parseInt(carData['throttle']);
           var cabinTemp;
           
           $("#speedField").text(speed)
           $("#rpmField").text(rpm)
           $("#throttleField").text(throttle)
           updateSpeedChart(speed);
           updateRpmChart(rpm);
         });
      </script>
      <div class="container">
         <table id="myTable" class="table" data-toggle="table" data-mobile-responsive="true" data-pagination="true" >
            <thead>
               <tr>
                  <th>Error Code (DTC)</th>
                  <th>Description</th>
                  <th></th>
               </tr>
            </thead>
            <tbody>
            </tbody>
         </table>
      </div>
      <script>
         var tbody = $('#myTable').children('tbody');
         
             var table = tbody.length ? tbody : $('#myTable');
             
             socket.on('faultCodeData', function(faultCodes) {
             
             for (var i = 0; i < faultCodes.length; i++) {
               
                 var codeDescArray = faultCodes[i];
                 var code = codeDescArray[0];
                 var description = codeDescArray[1];
         
                 //Only add row if fault code doesn't exist in table. 
                 if ($('#' + code).length == 0) {
                     table.append('<tr id=' + code + '><td><h5>' + code + '</h5></td><td><h5>' + description + '</h5></td></tr>');
                 } else if ($('#' + code) != null) {
                   
                 }
                 
             }
             $("#myTable").on('click', '.btnDelete', function() {
                 $(this).closest('tr').remove();
               });
             
         
             
           });
      </script>
   </body>
</html>
