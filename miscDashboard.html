<!DOCTYPE html>
<html>
    <body id="dashboardBody">
        <script src="/js/jquery.min.js"></script>
        <script src="/js/plotly-latest.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="/css/bootstrap-theme.min.css" />
        <link rel="stylesheet" type="text/css" href="/css/miscDashboard.css" />
        <script src="/js/socket.io.min.js"></script>
        <div id="gpsDiv" class="divider">
            <div class="container-fluid">
                <div class="row">
                    <div class="col col-sm-3">
                        <h4 class="bold">GPS</h4>
                    </div>
                    <div class="col col-sm-7" id="timeField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Latitude:</div>
                    <div class="col col-sm-3" id="latitudeField">--</div>
                    <div class="col col-sm-2">+/-</div>
                    <div class="col col-sm-2" id="latitudeErrField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Longitude:</div>
                    <div class="col col-sm-3" id="longitudeField">--</div>
                    <div class="col col-sm-2">+/-</div>
                    <div class="col col-sm-2" id="longitudeErrField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Altitude(ft):</div>
                    <div class="col col-sm-3" id="altitudeField">--</div>
                    <div class="col col-sm-2">+/-</div>
                    <div class="col col-sm-2" id="altitudeErrField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Speed(mph):</div>
                    <div class="col col-sm-3" id="speedField">--</div>
                    <div class="col col-sm-2">+/-</div>
                    <div class="col col-sm-2" id="speedErrField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Climb(ft/min):</div>
                    <div class="col col-sm-3" id="climbField">--</div>
                    <div class="col col-sm-2">+/-</div>
                    <div class="col col-sm-2" id="climbErrField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-3">Heading&deg;:</div>
                    <div class="col col-sm-3" id="headingField">--</div>
                    <div class="col col-sm-2"></div>
                    <div class="col col-sm-2"></div>
                </div>
                <div class="row hidden">
                    <div class="col-sm">Grid Square:</div>
                    <div class="col-sm"></div>
                    <div class="col-sm"></div>
                    <div class="col-sm"></div>
                </div>
            </div>
        </div>
        <div id="GyroPitchDiv" class="divider">

            <div class="container-fluid">
                <div class="row">
                    <div class="col col-sm-3">
                        <h4 class="bold">Pitch&deg;</h4>
                    </div>
                    <div class="col-sm">
                        <h4>--</h4>
                    </div>
                    <div class="col col-sm-3">
                        <h4 class="bold">Roll&deg;</h4>
                    </div>
                    <div class="col-sm">--</div>
                </div>
                <div class="row">
                    <div class="col-sm">
                        <div id="pitchGraph"></div>
                    </div>
                    <div class="col-sm">
                        <div id="rollGraph"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="airQualityDiv" class="divider">
            <div class="container-fluid">
                <div class="row">
                    <div class="col col-sm-4">
                        <h4 class="bold">Air Quality</h4>
                    </div>
                    <div class="col col-sm-7 borderGreen">
                        <div class="tab" id="airQualityBar">-</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col col-sm-2" id="pm10Header">PM1.0:</div>
                    <div class="col col-sm-2" id="pm10Field">--</div>
                    <div class="col col-sm-2" id="pm25Header">PM2.5:</div>
                    <div class="col col-sm-2" id="pm25Field">--</div>
                    <div class="col col-sm-2" id="pm100Header">PM10:</div>
                    <div class="col col-sm-2" id="pm100Field">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm3umHeader">PM > .3um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm3umField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm5umHeader">PM > .5um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm5umField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm10umHeader">PM > 1.0um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm10umField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm25umHeader">PM > 2.5um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm25umField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm50umHeader">PM > 5.0um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm50umField">--</div>
                </div>
                <div class="row">
                    <div class="col col-sm-6" id="pm100umHeader">PM > 10um / 0.1L air:</div>
                    <div class="col col-sm-2" id="pm100umField">--</div>
                </div>
                <div class="row hidden">
                    <div class="col col-sm-6" id="airQualityErrorHeader">Read Errors:</div>
                    <div class="col col-sm-2" id="airQualityErrorField">0</div>
                </div>
            </div>
        </div>
        <div id="miscDataDiv" class="divider">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm">
                        <h4 class="bold">Misc</h4>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm" id="cpuTempHeader">CPU Temp(&deg;F):</div>
                    <div class="col-sm" id="cpuTempField">--</div>
                    <div class="col-sm"></div>
                </div>
                <div class="row">
                    <div class="col-sm" id="logsHeader">Logs:</div>
                    <div class="col-sm"></div>
                    <div class="col-sm"></div>
                </div>
                <div class="row pad-left">
                    <div class="col-sm">N/A</div>
                </div>
            </div>
        </div>
    </body>
</html>

<script>
    $("#airQualityBar").width('100%');
    var x_max = 4; //max number of data points per plot

    var fontSize = 20;
    var defaultColor = '#00ba00';
    var plotBackgroundColor = '#000000';
    var plotHeight = 220;
    var plotWidth = 220;
    var plotLeftMargin = 0;
    var plotRightMargin = 0;
    var plotBottomMargin = 0;
    var plotTopMargin = 0;
    var padding = 1; //spacing between graph and labels
    var numXTicks = 5; //max number of x labels per graph
    var tickAngle = 0;
    var lineWidth = 1;

    var config = {
        responsive: true
    }

    var gpsPitchLayout = {
        autosize: true,
        height: plotHeight,
        width: plotWidth,
        margin: {
            l: plotLeftMargin,
            r: plotRightMargin,
            b: plotBottomMargin,
            t: plotTopMargin,
            pad: padding
        },
        xaxis: {
            tickangle: tickAngle,
            nticks: numXTicks,
            color: defaultColor,
            showgrid: false
        },
        yaxis: {
            color: defaultColor,
            showgrid: false
        },
        font: {
            size: fontSize,
            color: defaultColor
        },
        paper_bgcolor: plotBackgroundColor,
        plot_bgcolor: plotBackgroundColor
    };

    Plotly.react('pitchGraph', [{
        x: [0],
        y: [0],
        type: 'line',
        line: {
            color: defaultColor,
            width: lineWidth
        },
    }], gpsPitchLayout, config);

    function updatePitchGraph(angle) {



        var speedTrace = {
            x: [
                [time]
            ],
            y: [
                [speed]
            ]
        }
        Plotly.extendTraces('pitchGraph', speedTrace, [0], x_max);
    }


    var config = {
        responsive: true
    }

    var gpsRollLayout = {
        autosize: true,
        height: plotHeight,
        width: plotWidth,
        margin: {
            l: plotLeftMargin,
            r: plotRightMargin,
            b: plotBottomMargin,
            t: plotTopMargin,
            pad: padding
        },
        xaxis: {
            tickangle: tickAngle,
            nticks: numXTicks,
            color: defaultColor,
            showgrid: false
        },
        yaxis: {
            color: defaultColor,
            showgrid: false
        },
        font: {
            size: fontSize,
            color: defaultColor
        },
        paper_bgcolor: plotBackgroundColor,
        plot_bgcolor: plotBackgroundColor
    };

    Plotly.react('rollGraph', [{
        x: [0],
        y: [0],
        type: 'line',
        line: {
            color: defaultColor,
            width: lineWidth
        },
    }], gpsRollLayout, config);

    function updatePitchGraph(angle) {



        var speedTrace = {
            x: [
                [time]
            ],
            y: [
                [speed]
            ]
        }
        Plotly.extendTraces('rollGraph', speedTrace, [0], x_max);
    }

    var socket = io();
    if (socket != null) {
        $("#statusField").text = "Connected";
    }
    
    socket.on("airQualityData", function(msg) {
        updateAirQualityStats(msg);
    });
    
    socket.on("log", function(msg) {
        updateLogs(msg);
    });

    socket.on("gpsData", function(msg) {
        updateGpsStats(msg);
    });
    
    socket.on("orientationData", function(msg) {
        updatePitchGraph(pitchAngle);
        updateRollGraph(rollAngle);
    });
</script>

<script>
    function updateAirQualityStats(msg) {
        var data = $.parseJSON(msg);
        $("#pm10Field").text(data["pm10"]);
        $("#pm25Field").text(data["pm25"]);
        $("#pm100Field").text(data["pm100"]);
        $("#pm3umField").text(data["pm3um"]);
        $("#pm5umField").text(data["pm5um"]);
        $("#pm10umField").text(data["pm10um"]);
        $("#pm25umField").text(data["pm25um"]);
        $("#pm50umField").text(data["pm50um"]);
        $("#pm100umField").text(data["pm100um"]);   
    }
    
    function updateAirQualityError(msg) {
        var numErrors = parseInt(msg);
        $("#airQualityErrorField").text(
            parseInt($("#airQualityErrorField").text) + numErrors);
    }
    
    function updateGpsStats(msg) {
        var data = $.parseJSON(msg);
        $("#timeField").text(data["time"]);
        //$("#timeErrField").text(data["timeErr"]);
        $("#latitudeField").text(data["latitude"]);
        $("#latitudeErrField").text(data["latitudeErr"]);
        $("#longitudeField").text(data["longitude"]);
        $("#longitudeErrField").text(data["longitudeErr"]);
        $("#altitudeField").text(data["altitude"]);
        $("#altitudeErrField").text(data["altitudeErr"]);
        $("#speedField").text(data["speed"]);
        $("#speedErrField").text(data["speedErr"]);
        $("#climbField").text(data["climb"]);
        $("#climbErrField").text(data["climbErr"]);
        //$("#headingField").text(data["heading"]);
    }
</script>
